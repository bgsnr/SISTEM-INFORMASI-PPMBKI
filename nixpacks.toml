# =====================================================
# Laravel + Vite + PostgreSQL + Redis (Stable for Coolify)
# =====================================================

[phases.setup]
nixPkgs = [
  "php83",
  "php83Extensions.intl",
  "php83Extensions.mbstring",
  "php83Extensions.exif",
  "php83Extensions.fileinfo",
  "php83Extensions.zip",
  "php83Extensions.bcmath",
  "php83Extensions.pgsql",
  "php83Extensions.pdo_pgsql",
  "php83Packages.composer",
  "nodejs_20",
  "npm"
]

[phases.install]
cmds = [
  "php -v",
  "composer install --no-dev --optimize-autoloader --no-interaction",
  "npm install --no-fund --no-audit"
]

[phases.build]
cmds = [
  "npm run build || echo '⚠️  Vite build skipped (no frontend assets found)'"
]

[start]
cmd = "php artisan serve --host=0.0.0.0 --port=${PORT:-8000}"
